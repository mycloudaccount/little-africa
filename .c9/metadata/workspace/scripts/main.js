{"changed":true,"filter":false,"title":"main.js","tooltip":"/scripts/main.js","value":"var stage = null;\nvar clouds = [];\nvar background = null;\nvar loadingScreen = null;\n\n\nvar manifest = [\n\t{src:\"images/scene/Sun0.png\", id:\"sun0\"},\n\t{src:\"images/scene/Sun1.png\", id:\"sun1\"},\n\t{src:\"images/scene/Sun2.png\", id:\"sun2\"},\n\t{src:\"images/scene/Hills.png\", id:\"hills\"},\n\t{src:\"images/scene/Raindrop.png\", id:\"rainDrop\"},\n\t{src:\"images/scene/Cloud-light.png\", id:\"cloud_light\"},\n\t{src:\"images/scene/Sky-morning.png\", id:\"sky_morning\"},\n\t{src:\"images/scene/Sky-noon.png\", id:\"sky_noon\"},\n\t{src:\"images/scene/Sky-latenoon.png\", id:\"sky_latenoon\"},\n\t{src:\"images/scene/Sky-night.png\", id:\"sky_night\"}\n];\n\n// resources handlers\nvar handleProgress,\n\thandleComplete,\n\thandleFileLoad,\n\thandleLoadError,\n\thandleFileLoaded;\nvar totalLoaded = 0;\n\nfunction init()\n{\n\tstage = new createjs.Stage(\"mainCanvas\");\t\n\t\t\n    //use event.loaded to get the percentage of the loading\n\tloadingScreen = new createjs.Container();\n\tvar txt = new createjs.Text(\"Loading...\", \"20px Arial\", \"#cccccc\"); \n\ttxt.textBaseline = \"alphabetic\";\n\ttxt.name = 'txt';\n\tloadingScreen.addChild(txt);\n\tloadingScreen.x = (stage.canvas.width - 60) * 0.5; \n\tloadingScreen.y = (stage.canvas.height - 10) * 0.5; \n\tstage.addChild(loadingScreen);\n\tstage.update();\n\t\n\t\n\tvar loadQueue = new createjs.LoadQueue(true);\n    loadQueue.installPlugin(createjs.SoundJS);\n\tloadQueue.on(\"progress\", handleProgress, this);\n\tloadQueue.on(\"complete\", handleComplete, this);\n\tloadQueue.on(\"fileload\", handleFileLoad, this);\n\tloadQueue.on(\"error\", handleLoadError, this);\n    loadQueue.loadManifest(manifest);\t\n\t\n\tcreatejs.Ticker.addEventListener(window);\n\tcreatejs.Ticker.timingMode = createjs.Ticker.RAF_SYNCHED;\n\tcreatejs.Ticker.setFPS(30);\n\tcreatejs.Ticker.addEventListener(\"tick\", stage);\n}\n\nfunction main()\n{\n\t\n\tbackground = Background();\n    stage.addChild(background.sprite);\n\tstage.update();\n\t\t\n\t// clouds\n\tvar it = 0;\n\tfor(it=0;it<CLOUD_CNT;++it) {\n\t\tvar sizeFactor = Math.random();\n\t\tclouds[it] = Cloud(\n\t\t\t{\n\t\t\t\ttype:'light',\n\t\t\t\talpha: 1.0 - 0.3 * Math.random(),\n\t\t\t\tx: stage.canvas.width * Math.random(),\n\t\t\t\ty: 10 + 50 * Math.random(),\n\t\t\t\tvx: 1.0 - 0.7 * sizeFactor,\n\t\t\t\tvy:0,\n\t\t\t\tsx: 1.0 - 0.5 * sizeFactor,\n\t\t\t\tsy: 1.0 - 0.5 * sizeFactor\n\t\t\t}\n\t\t);\n\t\tstage.addChild(clouds[it].sprite);\n\t}\n\t\t\n\t//Update stage will render next frame\n\tcreatejs.Ticker.on(\"tick\", handleTick);\n}\n\nfunction handleProgress(event)\n{\n\tvar txt = loadingScreen.getChildByName('txt');\n\t\n\tswitch( txt.text ) {\n\t\tcase 'Loading.'\t:\n\t\t\ttxt.text = 'Loading..';\n\t\tbreak;\n\t\tcase 'Loading..'\t:\n\t\t\ttxt.text = 'Loading...';\n\t\tbreak;\n\t\tcase 'Loading...'\t:\n\t\t\ttxt.text = 'Loading.';\n\t\tbreak;\n\t}\n\t\n\tstage.update();\n\tconsole.log('preloading...');\n}\n\nfunction handleComplete(event) {\n    //triggered when all loading is complete\n\tstage.removeChild(loadingScreen);\n\tstage.update();\n\tconsole.log('preloading is complete.');\n}\n\nfunction handleLoadError(event) {\n    //triggered when all loading is complete\n\tconsole.log('TODO: add error details here!');\n}\n\nfunction handleFileLoad(event) {\n\t\n\tvar item = event.item;\n\t\n\tconsole.log('preloading: '+item.src + '...');\n\t\n\tswitch(item.type)\n\t{\n\t\tcase createjs.LoadQueue.IMAGE:\n\t\t\t//image loading\n\t\t\tvar img = new Image();\n\t\t\timg.src = item.src;\n\t\t\timg.onload = handleFileLoaded(item, img);\n\t\tbreak;\n \n\t\tcase createjs.LoadQueue.SVG:\n\t\t\t//svg loading\n\t\tbreak;\n\t\t\t\n\t\tcase createjs.LoadQueue.SOUND:\n\t\t\t//sound loading\n\t\t\thandleFileLoaded();\n\t\tbreak;\n\t}\n\t\n}\n\nfunction handleFileLoaded(item, resrc) \n{\n\tswitch(item.type)\n\t{\n\t\tcase createjs.LoadQueue.IMAGE:\n\t\t\t//image loaded - create bitmap from it\n\t\t\twindow[item.id] = new createjs.Bitmap(resrc);\n\t\t\t/*\n\t\t\twindow[item.id] = new createjs.Shape(\n\t\t\t\tnew createjs.Graphics().beginBitmapFill(\n\t\t\t\t\tresrc,'no-repeat').drawRect(\n\t\t\t\t\t0, \n\t\t\t\t\t0, \n\t\t\t\t\tresrc.width, \n\t\t\t\t\tresrc.height));\n\t\t\t\t\t*/\n\t\tbreak;\n \n\t\tcase createjs.LoadQueue.SVG:\n\t\t\t//image loaded - create bitmap from it\n\t\t\twindow[item.id] = new createjs.Bitmap(resrc);\n\t\tbreak;\n \n\t\tcase createjs.LoadQueue.SOUND:\n\t\t\t//sound loaded\n\t\tbreak;\n\t}\n\n\tconsole.log(item.src + ' has been loaded.');\n\ttotalLoaded++;\n    if(manifest.length===totalLoaded) {\n\t\tconsole.log('All Resources Are Loaded');\n\t   \tconsole.log('\\ttotal = '+totalLoaded);\n\t\tmain();\t\t\n\t}\n}\n\nfunction handleTick(event) \n{\t\n\tfor(var it in clouds) {\n\t\tclouds[it].draw();\n\t}\n\t\n\tbackground.draw();\t\n    stage.update(event);\n}\n","undoManager":{"mark":32,"position":50,"stack":[[{"group":"doc","deltas":[{"start":{"row":7,"column":7},"end":{"row":7,"column":8},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":8},"end":{"row":7,"column":9},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":9},"end":{"row":7,"column":10},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":10},"end":{"row":7,"column":11},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":11},"end":{"row":7,"column":12},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":12},"end":{"row":7,"column":13},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":12},"end":{"row":7,"column":13},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":11},"end":{"row":7,"column":12},"action":"remove","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":10},"end":{"row":7,"column":11},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":9},"end":{"row":7,"column":10},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":8},"end":{"row":7,"column":9},"action":"remove","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":7},"end":{"row":7,"column":8},"action":"remove","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":20},"end":{"row":7,"column":21},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":20},"end":{"row":7,"column":21},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":20},"end":{"row":8,"column":21},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":20},"end":{"row":8,"column":21},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":20},"end":{"row":9,"column":21},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":20},"end":{"row":9,"column":21},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":20},"end":{"row":10,"column":21},"action":"remove","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":20},"end":{"row":10,"column":21},"action":"insert","lines":["H"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":20},"end":{"row":11,"column":21},"action":"remove","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":20},"end":{"row":11,"column":21},"action":"insert","lines":["C"]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":20},"end":{"row":12,"column":21},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":20},"end":{"row":12,"column":21},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":20},"end":{"row":13,"column":21},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":20},"end":{"row":13,"column":21},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":20},"end":{"row":14,"column":21},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":20},"end":{"row":14,"column":21},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":20},"end":{"row":15,"column":21},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":20},"end":{"row":15,"column":21},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":0},"end":{"row":81,"column":0},"action":"remove","lines":["\t\t//stage.update();",""]}]}],[{"group":"doc","deltas":[{"start":{"row":83,"column":0},"end":{"row":85,"column":0},"action":"remove","lines":["    //createjs.Ticker.addEventListener(\"tick\", handleTick);","\t//createjs.Ticker.addEventListener('tick', handleTick);",""]}]}],[{"group":"doc","deltas":[{"start":{"row":84,"column":0},"end":{"row":85,"column":0},"action":"remove","lines":["\t//tkr.tick = handleTick;",""]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"remove","lines":["\t{src:\"images/scene/Cloud-light.png\", id:\"cloud_light\"},",""]},{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"insert","lines":["\t{src:\"images/scene/Cloud-light.png\", id:\"cloud_light\"},",""]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":0},"end":{"row":13,"column":0},"action":"insert","lines":["\t{src:\"images/scene/Cloud-light.png\", id:\"cloud_light\"},",""]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":20},"end":{"row":11,"column":31},"action":"remove","lines":["Cloud-light"]},{"start":{"row":11,"column":20},"end":{"row":11,"column":21},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":21},"end":{"row":11,"column":22},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":22},"end":{"row":11,"column":23},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":23},"end":{"row":11,"column":24},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":24},"end":{"row":11,"column":25},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":25},"end":{"row":11,"column":26},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":26},"end":{"row":11,"column":27},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":27},"end":{"row":11,"column":28},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":24},"end":{"row":11,"column":25},"action":"remove","lines":["d"]},{"start":{"row":11,"column":24},"end":{"row":11,"column":25},"action":"insert","lines":["D"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":24},"end":{"row":11,"column":25},"action":"remove","lines":["D"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":24},"end":{"row":11,"column":25},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":39},"end":{"row":11,"column":50},"action":"remove","lines":["cloud_light"]},{"start":{"row":11,"column":39},"end":{"row":11,"column":40},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":40},"end":{"row":11,"column":41},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":41},"end":{"row":11,"column":42},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":42},"end":{"row":11,"column":43},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":39},"end":{"row":11,"column":43},"action":"remove","lines":["rain"]},{"start":{"row":11,"column":39},"end":{"row":11,"column":47},"action":"insert","lines":["rainDrop"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":20},"end":{"row":11,"column":28},"action":"remove","lines":["Raindrop"]},{"start":{"row":11,"column":20},"end":{"row":11,"column":21},"action":"insert","lines":["C"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":21},"end":{"row":11,"column":22},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":22},"end":{"row":11,"column":23},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":23},"end":{"row":11,"column":24},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":24},"end":{"row":11,"column":25},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":24},"end":{"row":11,"column":25},"action":"remove","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":23},"end":{"row":11,"column":24},"action":"remove","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":22},"end":{"row":11,"column":23},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":21},"end":{"row":11,"column":22},"action":"remove","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":20},"end":{"row":11,"column":21},"action":"remove","lines":["C"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":11,"column":20},"end":{"row":11,"column":28},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1418851528100}